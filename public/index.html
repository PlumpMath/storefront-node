<html>
<head>
  <title></title>
  <style type="text/css">
  body {
    margin: 0;
  }
  
  span {
    display: block;
    width: 100%;
    height: 100%;
    position: fixed;
    text-align: center;
    margin-top: 45%;
    opacity: 0.1;
    font-size: 10em;
    font-family: monospace;
  }
  </style>
  <script src="p5.min.js"></script>
  <script type="text/javascript">
  var touchStroke = [];
  var px = null, py = null;
  
  function uniqueId () {
    console.log("uniqueId");
    return Math.random().toString(36).replace("0.", Date.now().toString(36))
  }
  
  function submitStroke (points) {
    console.log("submitStroke");
    var http = new XMLHttpRequest();
    var url = "stroke";
    var params = "id=" + uniqueId() + "&points=" + points.join(",");
    http.open("POST", url, true);

    //Send the proper header information along with the request
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.send(params);
  }
  
  function setup() {
    console.log("setup");
    createCanvas(windowWidth, windowHeight);
    background(255);
    strokeWeight(10)
    stroke(0);
  }
  
  function windowResized() {
    console.log("windowResized");
    resizeCanvas(windowWidth, windowHeight);
  }

  function touchStarted() {
    console.log("touchStarted");
    background(255)
    touchStroke = [];
    px = touchX;
    py = touchY;
    return false;
  }
  
  function touchEnded() {
    console.log("touchEnded");
    console.log(uniqueId(), touchStroke);
    // TODO submit to server, gensym id etc
    submitStroke(touchStroke);
    return false;
  }
  
  function touchMoved() {
    console.log("touchMoved");
    touchStroke.push(2 * (touchX / windowWidth - 0.5));
    touchStroke.push(2 * (touchY / windowHeight - 0.5));
    if(px != null && py != null)
      line(touchX, touchY, px, py);
    px = touchX;
    py = touchY;
    return false;
  }
  </script>
</head>
<body>
  <span>DRAW</span>
</body>
</html>